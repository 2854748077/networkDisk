import{k as F,r as g,l as O,Y as K,ag as C,o as m,c as k,a as l,Q as a,I as o,n as D,H as _,L as p,M as x,a6 as H,W as Q,O as W}from"./@vue-330d97db.js";import{u as Y,b as Z}from"./vue-router-058388f3.js";import{m as A}from"./js-md5-cda431b7.js";import{_ as G}from"./index-52c5c20a.js";import"./aplayer-d80f7f58.js";import"./element-plus-acb27f52.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-df397a67.js";import"./@element-plus-4e918346.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-2cb15ffa.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";import"./vue-cookies-191b1cbf.js";import"./@highlightjs-5c1784e4.js";import"./highlight.js-a76881e7.js";import"./axios-1f2f0c0e.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-021e3327.js";import"./vue-d736004e.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const J={class:"login-body"},X={class:"login-panel"},ee={key:1},oe={class:"send-emali-panel"},le={class:"check-code-panel"},se=["src"],te={class:"rememberme-panel"},re={class:"no-account"},ae={key:0},ie={key:1},ne={key:2},de={key:5,class:"login-btn-qq"},ue={class:"check-code-panel"},me=["src"],pe={__name:"Login",setup(fe){const{proxy:u}=F(),L=Y(),P=Z(),f={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd",qqlogin:"/qqlogin",githublogin:"/githublogin"},t=g(1),c=i=>{t.value=i,j()};O(()=>{c(1)});const N=(i,e,n)=>{e!==r.value.registerPassword?n(new Error(i.message)):n()},r=g({}),M=g(),h={email:[{required:!0,message:"请输入邮箱"},{validator:u.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:u.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:N,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},R=g(),U=g(),w=i=>{i==0?R.value=f.checkCode+"?type="+i+"&time="+new Date().getTime():U.value=f.checkCode+"?type="+i+"&time="+new Date().getTime()},V=g({}),q=g(),y=K({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{$()}}]}),S=()=>{M.value.validateField("email",i=>{i&&(y.show=!0,D(()=>{w(1),q.value.resetFields(),V.value={email:r.value.email}}))})},$=()=>{q.value.validate(async i=>{if(!i)return;const e=Object.assign({},V.value);e.type=t.value==0?0:1,await u.Request({url:f.sendMailCode,params:e,errorCallback:()=>{w(1)}})&&(u.Message.success("验证码发送成功，请登录邮箱查看"),y.show=!1)})},j=()=>{D(()=>{if(w(0),M.value.resetFields(),r.value={},t.value==1){const i=u.VueCookies.get("loginInfo");i&&(r.value=i)}})},I=()=>{M.value.validate(async i=>{if(!i)return;let e={};if(Object.assign(e,r.value),(t.value==0||t.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),t.value==1){let v=u.VueCookies.get("loginInfo"),b=v==null?null:v.password;e.password!==b&&(e.password=A(e.password))}let n=null;t.value==0?n=f.register:t.value==1?n=f.login:t.value==2&&(n=f.resetPwd);let d=await u.Request({url:n,params:e,errorCallback:()=>{w(0)}});if(d)if(t.value==0)u.Message.success("注册成功,请登录"),c(1);else if(t.value==1){if(e.rememberMe){const b={email:e.email,password:e.password,rememberMe:e.rememberMe};u.VueCookies.set("loginInfo",b,"7d")}else u.VueCookies.remove("loginInfo");u.Message.success("登录成功"),u.VueCookies.set("userInfo",d.data,0);const v=P.query.redirectUrl||"/";L.push(v)}else t.value==2&&(u.Message.success("重置密码成功,请登录"),c(1))})},B=async()=>{let i=await u.Request({url:f.githublogin,params:{callbackUrl:P.query.redirectUrl||""}});i&&(u.VueCookies.remove("userInfo"),document.location.href=i.data)};return(i,e)=>{const n=C("el-input"),d=C("el-form-item"),v=C("el-button"),b=C("el-popover"),E=C("el-checkbox"),z=C("el-form"),T=C("Dialog");return m(),k("div",J,[e[32]||(e[32]=l("div",{class:"bg"},null,-1)),l("div",X,[a(z,{class:"login-register",model:r.value,rules:h,ref_key:"formDataRef",ref:M},{default:o(()=>[e[30]||(e[30]=l("div",{class:"login-title"},"极简网盘",-1)),a(d,{prop:"email"},{default:o(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:r.value.email,"onUpdate:modelValue":e[0]||(e[0]=s=>r.value.email=s),modelModifiers:{trim:!0},maxLength:"150"},{prefix:o(()=>e[17]||(e[17]=[l("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),t.value==1?(m(),_(d,{key:0,prop:"password"},{default:o(()=>[a(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value.password=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[18]||(e[18]=[l("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),t.value==0||t.value==2?(m(),k("div",ee,[a(d,{prop:"emailCode"},{default:o(()=>[l("div",oe,[a(n,{size:"large",placeholder:"请输入邮箱验证码",modelValue:r.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=s=>r.value.emailCode=s),modelModifiers:{trim:!0}},{prefix:o(()=>e[19]||(e[19]=[l("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),a(v,{class:"send-mail-btn",type:"primary",size:"large",onClick:S},{default:o(()=>e[20]||(e[20]=[x("获取验证码")])),_:1})]),a(b,{placement:"left",width:500,trigger:"click"},{reference:o(()=>e[21]||(e[21]=[l("span",{class:"a-link",style:{"font-size":"14px"}},"未收到邮箱验证码？",-1)])),default:o(()=>[e[22]||(e[22]=l("div",null,[l("p",null,"1、在垃圾箱中查找邮箱验证码"),l("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮件地址白名单"),l("p",null," 3、将邮箱【laoluo@wuhancoder.com】添加到白名单不知道怎么设置？ ")],-1))]),_:1})]),_:1}),t.value==0?(m(),_(d,{key:0,prop:"nickName"},{default:o(()=>[a(n,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:r.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=s=>r.value.nickName=s),modelModifiers:{trim:!0},maxLength:"20"},{prefix:o(()=>e[23]||(e[23]=[l("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),a(d,{prop:"registerPassword"},{default:o(()=>[a(n,{type:"password",size:"large",placeholder:"请输入密码",modelValue:r.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=s=>r.value.registerPassword=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[24]||(e[24]=[l("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(d,{prop:"reRegisterPassword"},{default:o(()=>[a(n,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:r.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=s=>r.value.reRegisterPassword=s),modelModifiers:{trim:!0},"show-password":""},{prefix:o(()=>e[25]||(e[25]=[l("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):p("",!0),a(d,{prop:"checkCode"},{default:o(()=>[l("div",le,[a(n,{size:"large",placeholder:"请输入验证码",modelValue:r.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=s=>r.value.checkCode=s),modelModifiers:{trim:!0},onKeyup:H(I,["enter"])},{prefix:o(()=>e[26]||(e[26]=[l("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),l("img",{src:R.value,class:"check-code",onClick:e[7]||(e[7]=s=>w(0))},null,8,se)])]),_:1}),t.value==1?(m(),_(d,{key:2},{default:o(()=>[l("div",te,[a(E,{modelValue:r.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=s=>r.value.rememberMe=s)},{default:o(()=>e[27]||(e[27]=[x("记住我")])),_:1},8,["modelValue"])]),l("div",re,[l("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=s=>c(2))},"忘记密码？"),l("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=s=>c(0))},"没有账号？")])]),_:1})):p("",!0),t.value==0?(m(),_(d,{key:3},{default:o(()=>[l("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=s=>c(1))},"已有账号?")]),_:1})):p("",!0),t.value==2?(m(),_(d,{key:4},{default:o(()=>[l("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=s=>c(1))},"去登录?")]),_:1})):p("",!0),a(d,null,{default:o(()=>[a(v,{type:"primary",class:"op-btn",onClick:I,size:"large"},{default:o(()=>[t.value==0?(m(),k("span",ae,"注册")):p("",!0),t.value==1?(m(),k("span",ie,"登录")):p("",!0),t.value==2?(m(),k("span",ne,"重置密码")):p("",!0)]),_:1})]),_:1}),t.value==1?(m(),k("div",de,[e[29]||(e[29]=x(" 快捷登录 ")),(m(),k("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"#24292e",onClick:B,style:{cursor:"pointer","margin-left":"10px"}},e[28]||(e[28]=[l("path",{d:"M12 0C5.374 0 0 5.373 0 12C0 17.302 3.438 21.8 8.207 23.387C8.806 23.498 9.025 23.126 9.025 22.81C9.025 22.524 9.015 21.749 9.01 20.732C5.672 21.489 4.968 19.15 4.968 19.15C4.421 17.777 3.634 17.407 3.634 17.407C2.545 16.659 3.717 16.675 3.717 16.675C4.922 16.759 5.556 17.912 5.556 17.912C6.626 19.746 8.363 19.216 9.048 18.909C9.155 18.134 9.466 17.604 9.81 17.305C7.145 17 4.343 15.971 4.343 11.374C4.343 10.063 4.812 8.993 5.579 8.153C5.455 7.85 5.044 6.629 5.696 4.977C5.696 4.977 6.704 4.655 8.997 6.207C9.954 5.941 10.98 5.808 12 5.803C13.02 5.808 14.047 5.941 15.006 6.207C17.297 4.655 18.303 4.977 18.303 4.977C18.956 6.63 18.545 7.851 18.421 8.153C19.191 8.993 19.656 10.064 19.656 11.374C19.656 15.983 16.849 16.998 14.177 17.295C14.607 17.667 15.002 18.397 15.002 19.517C15.002 21.132 14.988 22.436 14.988 22.81C14.988 23.129 15.204 23.504 15.813 23.386C20.565 21.797 24 17.3 24 12C24 5.373 18.627 0 12 0Z"},null,-1)])))])):p("",!0)]),_:1},8,["model"])]),a(T,{show:y.show,title:y.title,buttons:y.buttons,width:"500px",showCancel:!1,onClose:e[16]||(e[16]=s=>y.show=!1)},{default:o(()=>[a(z,{model:V.value,rules:h,ref_key:"formData4SendMailCodeRef",ref:q,"label-width":"80px",onSubmit:e[15]||(e[15]=Q(()=>{},["prevent"]))},{default:o(()=>[a(d,{label:"邮箱"},{default:o(()=>[x(W(r.value.email),1)]),_:1}),a(d,{label:"验证码",prop:"checkCode"},{default:o(()=>[l("div",ue,[a(n,{size:"large",placeholder:"请输入验证码",modelValue:V.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=s=>V.value.checkCode=s),modelModifiers:{trim:!0}},{prefix:o(()=>e[31]||(e[31]=[l("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),l("img",{src:U.value,class:"check-code",onClick:e[14]||(e[14]=s=>w(1))},null,8,me)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},Fe=G(pe,[["__scopeId","data-v-0058f95d"]]);export{Fe as default};
