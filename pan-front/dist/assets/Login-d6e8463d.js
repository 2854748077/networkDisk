import{k as O,r as g,l as H,Y as K,ag as k,o as m,c as y,a as o,Q as i,I as s,n as D,H as b,L as p,M as x,a6 as A,W as G,O as Q}from"./@vue-330d97db.js";import{u as W,b as Y}from"./vue-router-058388f3.js";import{m as J}from"./js-md5-cda431b7.js";import{_ as X}from"./index-951ade64.js";import"./aplayer-d80f7f58.js";import"./element-plus-acb27f52.js";import"./lodash-es-32f1e46b.js";import"./@vueuse-df397a67.js";import"./@element-plus-4e918346.js";import"./@popperjs-c75af06c.js";import"./@ctrl-f8748455.js";import"./dayjs-2cb15ffa.js";import"./async-validator-10c6301d.js";import"./memoize-one-297ddbcb.js";import"./normalize-wheel-es-ed76fb12.js";import"./@floating-ui-5ec34e26.js";import"./vue-cookies-191b1cbf.js";import"./@highlightjs-5c1784e4.js";import"./highlight.js-a76881e7.js";import"./axios-1f2f0c0e.js";import"./docx-preview-30c6d22b.js";import"./jszip-d9c085e9.js";import"./xlsx-04f2268f.js";import"./vue-pdf-embed-021e3327.js";import"./vue-d736004e.js";import"./dplayer-ff9c2365.js";import"./vue-clipboard3-abb1cd37.js";import"./clipboard-2fdbe17c.js";const Z="/assets/qq-8fddb348.png",ee="data:image/png;base64,IA==";const oe={class:"login-body"},se={class:"login-panel"},le={key:1},te={class:"send-emali-panel"},re={class:"check-code-panel"},ae=["src"],ie={class:"rememberme-panel"},ne={class:"no-account"},de={key:0},ue={key:1},me={key:2},pe={key:5,class:"login-btn-qq"},ce={class:"check-code-panel"},fe=["src"],ve={__name:"Login",setup(ge){const{proxy:n}=O(),L=W(),q=Y(),c={checkCode:"/api/checkCode",sendMailCode:"/sendEmailCode",register:"/register",login:"/login",resetPwd:"/resetPwd",qqlogin:"/qqlogin",githublogin:"/githublogin"},t=g(1),f=a=>{t.value=a,j()};H(()=>{f(1)});const N=(a,e,d)=>{e!==r.value.registerPassword?d(new Error(a.message)):d()},r=g({}),M=g(),h={email:[{required:!0,message:"请输入邮箱"},{validator:n.Verify.email,message:"请输入正确的邮箱"}],password:[{required:!0,message:"请输入密码"}],emailCode:[{required:!0,message:"请输入邮箱验证码"}],nickName:[{required:!0,message:"请输入昵称"}],registerPassword:[{required:!0,message:"请输入密码"},{validator:n.Verify.password,message:"密码只能是数字，字母，特殊字符 8-18位"}],reRegisterPassword:[{required:!0,message:"请再次输入密码"},{validator:N,message:"两次输入的密码不一致"}],checkCode:[{required:!0,message:"请输入图片验证码"}]},U=g(),R=g(),w=a=>{a==0?U.value=c.checkCode+"?type="+a+"&time="+new Date().getTime():R.value=c.checkCode+"?type="+a+"&time="+new Date().getTime()},_=g({}),P=g(),C=K({show:!1,title:"发送邮箱验证码",buttons:[{type:"primary",text:"发送验证码",click:()=>{$()}}]}),S=()=>{M.value.validateField("email",a=>{a&&(C.show=!0,D(()=>{w(1),P.value.resetFields(),_.value={email:r.value.email}}))})},$=()=>{P.value.validate(async a=>{if(!a)return;const e=Object.assign({},_.value);e.type=t.value==0?0:1,await n.Request({url:c.sendMailCode,params:e,errorCallback:()=>{w(1)}})&&(n.Message.success("验证码发送成功，请登录邮箱查看"),C.show=!1)})},j=()=>{D(()=>{if(w(0),M.value.resetFields(),r.value={},t.value==1){const a=n.VueCookies.get("loginInfo");a&&(r.value=a)}})},I=()=>{M.value.validate(async a=>{if(!a)return;let e={};if(Object.assign(e,r.value),(t.value==0||t.value==2)&&(e.password=e.registerPassword,delete e.registerPassword,delete e.reRegisterPassword),t.value==1){let v=n.VueCookies.get("loginInfo"),V=v==null?null:v.password;e.password!==V&&(e.password=J(e.password))}let d=null;t.value==0?d=c.register:t.value==1?d=c.login:t.value==2&&(d=c.resetPwd);let u=await n.Request({url:d,params:e,errorCallback:()=>{w(0)}});if(u)if(t.value==0)n.Message.success("注册成功,请登录"),f(1);else if(t.value==1){if(e.rememberMe){const V={email:e.email,password:e.password,rememberMe:e.rememberMe};n.VueCookies.set("loginInfo",V,"7d")}else n.VueCookies.remove("loginInfo");n.Message.success("登录成功"),n.VueCookies.set("userInfo",u.data,0);const v=q.query.redirectUrl||"/";L.push(v)}else t.value==2&&(n.Message.success("重置密码成功,请登录"),f(1))})},E=async()=>{let a=await n.Request({params:{callbackUrl:q.query.redirectUrl||""}});a&&(n.VueCookies.remove("userInfo"),document.location.href=a.data)},T=async()=>{let a=await n.Request({url:c.githublogin,params:{callbackUrl:q.query.redirectUrl||""}});a&&(n.VueCookies.remove("userInfo"),document.location.href=a.data)};return(a,e)=>{const d=k("el-input"),u=k("el-form-item"),v=k("el-button"),V=k("el-popover"),B=k("el-checkbox"),z=k("el-form"),F=k("Dialog");return m(),y("div",oe,[e[31]||(e[31]=o("div",{class:"bg"},null,-1)),o("div",se,[i(z,{class:"login-register",model:r.value,rules:h,ref_key:"formDataRef",ref:M},{default:s(()=>[e[29]||(e[29]=o("div",{class:"login-title"},"极简网盘",-1)),i(u,{prop:"email"},{default:s(()=>[i(d,{size:"large",clearable:"",placeholder:"请输入邮箱",modelValue:r.value.email,"onUpdate:modelValue":e[0]||(e[0]=l=>r.value.email=l),modelModifiers:{trim:!0},maxLength:"150"},{prefix:s(()=>e[17]||(e[17]=[o("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1}),t.value==1?(m(),b(u,{key:0,prop:"password"},{default:s(()=>[i(d,{type:"password",size:"large",placeholder:"请输入密码",modelValue:r.value.password,"onUpdate:modelValue":e[1]||(e[1]=l=>r.value.password=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[18]||(e[18]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),t.value==0||t.value==2?(m(),y("div",le,[i(u,{prop:"emailCode"},{default:s(()=>[o("div",te,[i(d,{size:"large",placeholder:"请输入邮箱验证码",modelValue:r.value.emailCode,"onUpdate:modelValue":e[2]||(e[2]=l=>r.value.emailCode=l),modelModifiers:{trim:!0}},{prefix:s(()=>e[19]||(e[19]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),i(v,{class:"send-mail-btn",type:"primary",size:"large",onClick:S},{default:s(()=>e[20]||(e[20]=[x("获取验证码")])),_:1})]),i(V,{placement:"left",width:500,trigger:"click"},{reference:s(()=>e[21]||(e[21]=[o("span",{class:"a-link",style:{"font-size":"14px"}},"未收到邮箱验证码？",-1)])),default:s(()=>[e[22]||(e[22]=o("div",null,[o("p",null,"1、在垃圾箱中查找邮箱验证码"),o("p",null,"2、在邮箱中头像->设置->反垃圾->白名单->设置邮件地址白名单"),o("p",null," 3、将邮箱【laoluo@wuhancoder.com】添加到白名单不知道怎么设置？ ")],-1))]),_:1})]),_:1}),t.value==0?(m(),b(u,{key:0,prop:"nickName"},{default:s(()=>[i(d,{size:"large",clearable:"",placeholder:"请输入昵称",modelValue:r.value.nickName,"onUpdate:modelValue":e[3]||(e[3]=l=>r.value.nickName=l),modelModifiers:{trim:!0},maxLength:"20"},{prefix:s(()=>e[23]||(e[23]=[o("span",{class:"iconfont icon-account"},null,-1)])),_:1},8,["modelValue"])]),_:1})):p("",!0),i(u,{prop:"registerPassword"},{default:s(()=>[i(d,{type:"password",size:"large",placeholder:"请输入密码",modelValue:r.value.registerPassword,"onUpdate:modelValue":e[4]||(e[4]=l=>r.value.registerPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[24]||(e[24]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1}),i(u,{prop:"reRegisterPassword"},{default:s(()=>[i(d,{type:"password",size:"large",placeholder:"请再次输入密码",modelValue:r.value.reRegisterPassword,"onUpdate:modelValue":e[5]||(e[5]=l=>r.value.reRegisterPassword=l),modelModifiers:{trim:!0},"show-password":""},{prefix:s(()=>e[25]||(e[25]=[o("span",{class:"iconfont icon-password"},null,-1)])),_:1},8,["modelValue"])]),_:1})])):p("",!0),i(u,{prop:"checkCode"},{default:s(()=>[o("div",re,[i(d,{size:"large",placeholder:"请输入验证码",modelValue:r.value.checkCode,"onUpdate:modelValue":e[6]||(e[6]=l=>r.value.checkCode=l),modelModifiers:{trim:!0},onKeyup:A(I,["enter"])},{prefix:s(()=>e[26]||(e[26]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),o("img",{src:U.value,class:"check-code",onClick:e[7]||(e[7]=l=>w(0))},null,8,ae)])]),_:1}),t.value==1?(m(),b(u,{key:2},{default:s(()=>[o("div",ie,[i(B,{modelValue:r.value.rememberMe,"onUpdate:modelValue":e[8]||(e[8]=l=>r.value.rememberMe=l)},{default:s(()=>e[27]||(e[27]=[x("记住我")])),_:1},8,["modelValue"])]),o("div",ne,[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[9]||(e[9]=l=>f(2))},"忘记密码？"),o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[10]||(e[10]=l=>f(0))},"没有账号？")])]),_:1})):p("",!0),t.value==0?(m(),b(u,{key:3},{default:s(()=>[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[11]||(e[11]=l=>f(1))},"已有账号?")]),_:1})):p("",!0),t.value==2?(m(),b(u,{key:4},{default:s(()=>[o("a",{href:"javascript:void(0)",class:"a-link",onClick:e[12]||(e[12]=l=>f(1))},"去登录?")]),_:1})):p("",!0),i(u,null,{default:s(()=>[i(v,{type:"primary",class:"op-btn",onClick:I,size:"large"},{default:s(()=>[t.value==0?(m(),y("span",de,"注册")):p("",!0),t.value==1?(m(),y("span",ue,"登录")):p("",!0),t.value==2?(m(),y("span",me,"重置密码")):p("",!0)]),_:1})]),_:1}),t.value==1?(m(),y("div",pe,[e[28]||(e[28]=x(" 快捷登录 ")),o("img",{src:Z,onClick:E}),o("img",{src:ee,onClick:T,style:{"margin-left":"10px",width:"20px",cursor:"pointer"},title:"GitHub登录"})])):p("",!0)]),_:1},8,["model"])]),i(F,{show:C.show,title:C.title,buttons:C.buttons,width:"500px",showCancel:!1,onClose:e[16]||(e[16]=l=>C.show=!1)},{default:s(()=>[i(z,{model:_.value,rules:h,ref_key:"formData4SendMailCodeRef",ref:P,"label-width":"80px",onSubmit:e[15]||(e[15]=G(()=>{},["prevent"]))},{default:s(()=>[i(u,{label:"邮箱"},{default:s(()=>[x(Q(r.value.email),1)]),_:1}),i(u,{label:"验证码",prop:"checkCode"},{default:s(()=>[o("div",ce,[i(d,{size:"large",placeholder:"请输入验证码",modelValue:_.value.checkCode,"onUpdate:modelValue":e[13]||(e[13]=l=>_.value.checkCode=l),modelModifiers:{trim:!0}},{prefix:s(()=>e[30]||(e[30]=[o("span",{class:"iconfont icon-checkcode"},null,-1)])),_:1},8,["modelValue"]),o("img",{src:R.value,class:"check-code",onClick:e[14]||(e[14]=l=>w(1))},null,8,fe)])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},Ke=X(ve,[["__scopeId","data-v-052662ce"]]);export{Ke as default};
